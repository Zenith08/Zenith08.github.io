[{"name":"/#Supabase Prefab/Supabase Prefab/User/Supabase - Fetch Current User Profile Data","nodes":[{"id":"b37c2aa9-e546-a269-ee62-b0171e609cfd","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"79245f41-bd5e-b8b1-d196-7671231eb793","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"4a884b41-525f-3151-a7d8-d4b6e91424f1","type":"JavaScriptFunction","parameters":{"functionScript":"if (!Boolean(Noodl.Variables.supabase)){\n    console.error(\"Supabase client not initialized\")\n    return\n}\n\nif (!Boolean(Noodl.Object.exists(\"currentUser\"))) {\n    console.error(\"currentUser fetchProfile Data : currentUser is not initialized\")\n    return\n}\n\nif (!Boolean(Noodl.Objects.currentUser.auth.id)) {\n    console.error(\"currentUser supabase id is not initialized\")\n    return\n}\n\nconst userId = Noodl.Objects.currentUser.auth.id\n\ntry {\n\n    let userProfileTable = Noodl.Variables.Supabase_userProfileTableName\n\n    const { data, error } = await Noodl.Variables.supabase\n        .from(userProfileTable)\n        .select()\n        .eq(\"id\",userId)\n    \n    console.log(\"[fetch currentUser Profile] data : \",data)\n\n    if (data.length>0) {\n        let currUser = Noodl.Object.get(\"currentUser\")\n        //data[0].sbid = data[0].id\n        //data[0].id = \"userProfile\"\n        currUser.set(\"profile\", data[0])\n        console.log(\"[currentUser fetchProfileData] retrieving user profile\", currUser.profile)\n\n        Outputs.Success()\n\n    } else {\n        Outputs.error = \"No such user\"\n        Outputs.NoUserData()\n    }\n\n} catch (error) {\n    console.error(error)\n    Outputs.Failure()\n}\n"},"ports":[{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":4},{"name":"out-NoUserData","displayName":"NoUserData","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":7}],"children":[]},{"id":"350bca70-fd8e-59d4-7c3d-81bba1b23f5c","type":"Event Sender","parameters":{},"ports":[],"children":[]},{"id":"2dd1db67-cb83-b6dc-38a1-50f93c8266ae","type":"Event Sender","parameters":{"channelName":"Supabase Current User Updated"},"ports":[],"children":[]}],"connections":[{"sourceId":"b37c2aa9-e546-a269-ee62-b0171e609cfd","sourcePort":"Do","targetId":"4a884b41-525f-3151-a7d8-d4b6e91424f1","targetPort":"run"},{"sourceId":"4a884b41-525f-3151-a7d8-d4b6e91424f1","sourcePort":"out-Failure","targetId":"79245f41-bd5e-b8b1-d196-7671231eb793","targetPort":"Failure"},{"sourceId":"4a884b41-525f-3151-a7d8-d4b6e91424f1","sourcePort":"out-NoUserData","targetId":"79245f41-bd5e-b8b1-d196-7671231eb793","targetPort":"No User Data"},{"sourceId":"4a884b41-525f-3151-a7d8-d4b6e91424f1","sourcePort":"out-error","targetId":"79245f41-bd5e-b8b1-d196-7671231eb793","targetPort":"Error"},{"sourceId":"4a884b41-525f-3151-a7d8-d4b6e91424f1","sourcePort":"out-Success","targetId":"2dd1db67-cb83-b6dc-38a1-50f93c8266ae","targetPort":"sendEvent"},{"sourceId":"4a884b41-525f-3151-a7d8-d4b6e91424f1","sourcePort":"out-Success","targetId":"79245f41-bd5e-b8b1-d196-7671231eb793","targetPort":"Success"}],"ports":[{"name":"Success","type":"signal","plug":"output","index":0},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":0},{"name":"Failure","type":"signal","plug":"output","index":1},{"name":"No User Data","type":"signal","plug":"output","index":2},{"name":"Error","type":"*","plug":"output","index":3},{"name":"Data","type":"*","plug":"output","index":4}],"roots":[]},{"name":"/#Supabase Prefab/Supabase Prefab/User/Supabase - Update Current User Profile Data","nodes":[{"id":"c75c9ced-a382-faba-2f69-967cf94d7537","type":"Component Inputs","parameters":{},"ports":[],"children":[]},{"id":"11531329-440f-96e4-6b8c-d85df494ddb5","type":"Component Outputs","parameters":{},"ports":[],"children":[]},{"id":"af577687-6f5c-adbe-bf60-9170ed56443b","type":"JavaScriptFunction","parameters":{"functionScript":"if (!Boolean(Noodl.Variables.supabase)) {\n  console.error(\"Supabase client is not initialized\")\n  return\n}\nlet currUser = Noodl.Object.get(\"currentUser\")\nconsole.log(\"[updateUserData] sbid : \",currUser.sbid)\nconsole.log(\"[updateUserData] data to Update : \",Inputs.data)\n\nconst upData = Inputs.data\n\nconst { data, error } = await Noodl.Variables.supabase\n    .from(\"user_profile\")\n    .upsert(upData)\n\nconsole.log(\"[updateUserData] error : \",error)\nconsole.log(\"[updateUserData] data : \",data)\n\nif (error) {\n\n  Outputs.error = error\n  Outputs.Failure()\n\n} else {\n  Outputs.data = data\n  Outputs.Success()\n}\n\n\n"},"ports":[{"name":"in-data","displayName":"data","plug":"input","type":"*","group":"Inputs","index":4},{"name":"out-Failure","displayName":"Failure","plug":"output","type":"signal","group":"Outputs","index":5},{"name":"out-Success","displayName":"Success","plug":"output","type":"signal","group":"Outputs","index":6},{"name":"out-error","displayName":"error","plug":"output","type":"*","group":"Outputs","index":7},{"name":"out-data","displayName":"data","plug":"output","type":"*","group":"Outputs","index":8}],"children":[]},{"id":"0bd61b0d-10b6-1ee4-f717-223863d66464","type":"/#Supabase Prefab/Supabase Prefab/User/Supabase - Fetch Current User Profile Data","parameters":{},"ports":[],"children":[]}],"connections":[{"sourceId":"c75c9ced-a382-faba-2f69-967cf94d7537","sourcePort":"Do","targetId":"af577687-6f5c-adbe-bf60-9170ed56443b","targetPort":"run"},{"sourceId":"af577687-6f5c-adbe-bf60-9170ed56443b","sourcePort":"out-error","targetId":"11531329-440f-96e4-6b8c-d85df494ddb5","targetPort":"Error"},{"sourceId":"af577687-6f5c-adbe-bf60-9170ed56443b","sourcePort":"out-Failure","targetId":"11531329-440f-96e4-6b8c-d85df494ddb5","targetPort":"Failure"},{"sourceId":"c75c9ced-a382-faba-2f69-967cf94d7537","sourcePort":"Data","targetId":"af577687-6f5c-adbe-bf60-9170ed56443b","targetPort":"in-data"},{"sourceId":"af577687-6f5c-adbe-bf60-9170ed56443b","sourcePort":"out-Success","targetId":"0bd61b0d-10b6-1ee4-f717-223863d66464","targetPort":"Do"},{"sourceId":"0bd61b0d-10b6-1ee4-f717-223863d66464","sourcePort":"Success","targetId":"11531329-440f-96e4-6b8c-d85df494ddb5","targetPort":"Success"},{"sourceId":"0bd61b0d-10b6-1ee4-f717-223863d66464","sourcePort":"Failure","targetId":"11531329-440f-96e4-6b8c-d85df494ddb5","targetPort":"Failure"}],"ports":[{"name":"Success","type":"signal","plug":"output","index":0},{"name":"Do","type":{"name":"signal","allowConnectionsOnly":true},"group":"Actions","plug":"input","index":0},{"name":"Failure","type":{"name":"signal"},"plug":"output","index":1},{"name":"Data","type":"*","group":"Inputs","plug":"input","index":1},{"name":"Data","type":"*","plug":"output","index":2},{"name":"Error","type":"*","plug":"output","index":3}],"roots":[]}]